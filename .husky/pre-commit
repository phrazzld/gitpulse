#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Run lint and typecheck
npm run lint && npm run typecheck

# File length check
echo "Checking file lengths..."
warning_length=500
error_length=1000
has_error=0

for file in $(git diff --cached --name-only --diff-filter=ACMRT | grep -E '\.(ts|tsx|js|jsx)$'); do
  line_count=$(wc -l < "$file")
  
  if [ "$line_count" -gt "$error_length" ]; then
    echo "ERROR: $file has $line_count lines (exceeds limit of $error_length)"
    has_error=1
  elif [ "$line_count" -gt "$warning_length" ]; then
    echo "WARNING: $file has $line_count lines (exceeds recommended limit of $warning_length)"
  fi
done

if [ "$has_error" -eq 1 ]; then
  echo "Files exceeding the maximum length of $error_length lines were found. Please refactor them."
  exit 1
fi